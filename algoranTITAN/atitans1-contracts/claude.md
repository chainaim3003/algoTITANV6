# AlgoKit Smart Contract Deployment Issue Resolution

## Problem
Deployment of `negotiable_fin_bl_v1` contract failed with:
- `TypeError: appClient.deploy is not a function`
- `Error: App not found for creator ... and name NegotiableFinBLV1`
- `TypeError: typedFactory is not a constructor`

## Root Cause
The client files needed to be regenerated to include the proper `Factory` exports required for the standard AlgoKit deployment pattern.

## Solution

### Step 1: Regenerate Client Files
The client files are auto-generated by AlgoKit. Run the build command to ensure all client files are properly generated with Factory exports:

```bash
npm run build
```

This runs: `algokit compile ts smart_contracts --output-source-map --out-dir artifacts && algokit generate client smart_contracts/artifacts --output {app_spec_dir}/{contract_name}Client.ts`

### Step 2: Use Standard AlgoKit Factory Pattern
After regeneration, use the exact same pattern as working contracts (HelloWorld, NegotiableBL):

```typescript
import { AlgorandClient } from '@algorandfoundation/algokit-utils'
import { NegotiableFinBlv1Factory } from '../artifacts/negotiable_fin_bl_v1/NegotiableFinBLV1Client'

export async function deploy() {
  const algorand = AlgorandClient.fromEnvironment()
  const deployer = await algorand.account.fromEnvironment('DEPLOYER')

  // Use the standard AlgoKit Factory pattern
  const factory = algorand.client.getTypedAppFactory(NegotiableFinBlv1Factory, {
    defaultSender: deployer.addr,
  })

  const { appClient, result } = await factory.deploy({ 
    onUpdate: 'append', 
    onSchemaBreak: 'append' 
  })

  // Fund newly created apps
  if (['create', 'replace'].includes(result.operationPerformed)) {
    await algorand.send.payment({
      amount: (10).algo(),
      sender: deployer.addr,
      receiver: appClient.appAddress,
    })
  }
}
```

### Step 3: Deploy
```bash
npm run deploy:ci negotiable_fin_bl_v1
```

## Key AlgoKit TypeScript Patterns

### Correct Factory-based Deployment Pattern
```typescript
// âœ… CORRECT - Standard AlgoKit pattern
const factory = algorand.client.getTypedAppFactory(ContractFactory, {
  defaultSender: deployer.addr,
})
const { appClient, result } = await factory.deploy({ options })
```

### Available algorand.client Methods (from working examples):
- `algorand.client.getTypedAppFactory()` - For Factory-based deployment
- `algorand.client.getAppClientByCreatorAndName()` - For existing apps only

### Build Process
- AlgoKit auto-generates client files with TypeScript bindings
- Factory exports are created during client generation
- Always run `npm run build` after contract changes

## Final Resolution
After running `npm run build`, the NegotiableFinBLV1Client.ts file was properly generated with the `NegotiableFinBlv1Factory` export. The deploy-config.ts was updated to use the correct import name (`NegotiableFinBlv1Factory` not `NegotiableFinBlV1Factory` - note the lowercase 'v' in the generated name).

## References
- AlgoKit Utils Documentation: https://github.com/algorandfoundation/algokit-utils-ts
- Working examples in project: `hello_world/deploy-config.ts`, `negotiable_bl/deploy-config.ts`
